<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
<head>
    <title>TODO supply a title</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--<script src="js/client.js"></script>-->
</head>
<body>
<!-- Server responses get written here -->
<form onsubmit="onSubmitForm(event)">
    <pre id="client-output"></pre>
    <input id="client-message" onkeydown="onSubmitForm(event)" style="width: 80%" />
    <input type="submit" value="Send" style="width: 15%" />
</form>


<!-- Script to utilise the WebSocket -->
<script type="text/javascript">
    var clientWorker = new Worker('js/client-worker.js');
    function sendMessage(message) {
        if(typeof message === 'undefined') {
            var inputMessage = document.getElementById('client-message');
            message = inputMessage.value;
            inputMessage.value = '';
        }
        if(!message) throw new Error("Empty Message");
        clientWorker.postMessage(message);
    }

    function onSubmitForm(e) {
        switch(e.type) {
            case 'keydown':
                if(e.keyCode === 13) {
                    e.preventDefault();
                    sendMessage();
                }
                break;

            case 'submit':
                e.preventDefault();
                sendMessage();
                break;

            default:
                throw new Error("Unknown event: " + e.type);
        }
        return false;
    }

    function onMessage(e) {
        if(typeof e === 'string') e = {data:e};

        var args = e.data.split(/\s+/);
        switch(args[0].toLowerCase()) {
            case 'message':
                var messages = document.getElementById("client-output");
                messages.innerHTML += e.data + "\n";
                break;
            default:
                throw new Error("Unknown Command: " + args[0]);
        }
    }
    clientWorker.onmessage = onMessage;


    sendMessage('join /country/israel/politics');
</script>

</body>
</html>
